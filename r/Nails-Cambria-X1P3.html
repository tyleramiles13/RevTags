<script>
(function () {
  const reviewText = document.getElementById("reviewText");
  const googleBtn = document.getElementById("googleBtn");
  const draftBtn = document.getElementById("draftBtn");

  if (!reviewText) return;

  // ---- Lock textbox AFTER a draft appears ----
  let lockedOnce = false;

  function lockBox() {
    if (lockedOnce) return;
    lockedOnce = true;

    reviewText.readOnly = true;
    reviewText.style.background = "#f6f6f6";
    reviewText.style.cursor = "default";
  }

  const watch = setInterval(() => {
    const hasText = (reviewText.value || "").trim().length > 0;
    if (hasText) {
      lockBox();
      clearInterval(watch);
    }
  }, 250);

  // If they click Draft, unlock temporarily until draft arrives
  if (draftBtn) {
    draftBtn.addEventListener("click", () => {
      reviewText.readOnly = false;
      reviewText.style.background = "";
      reviewText.style.cursor = "";
      lockedOnce = false;
    });
  }

  // ---- Redirect delay to Google (FIXED FOR iPHONE) ----
  if (googleBtn) {
    googleBtn.addEventListener("click", (e) => {
      const url = googleBtn.getAttribute("href") || "#";
      if (!url || url === "#") return;

      e.preventDefault();

      const original = googleBtn.textContent;
      googleBtn.textContent = "Opening Googleâ€¦";
      googleBtn.style.pointerEvents = "none";

      // Delay time (tweak if you want)
      const delayMs = 1800;

      // IMPORTANT: open a tab immediately (user gesture)
      const newWin = window.open("about:blank", "_blank");

      setTimeout(() => {
        try {
          if (newWin && !newWin.closed) {
            newWin.location.href = url;   // redirect the already-open tab
          } else {
            // fallback if popup blocked
            window.location.href = url;   // open in same tab
          }
        } finally {
          googleBtn.textContent = original;
          googleBtn.style.pointerEvents = "";
        }
      }, delayMs);
    });
  }
})();
</script>