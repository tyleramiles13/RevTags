<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Leave a Review</title>

  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="../styles.css">
</head>
<body>

<div class="card"
  data-employee="Whitney"
  data-business="Urban Oasis Massage & Wellness"
  data-business-type="massage"
  data-google-review-url="https://www.google.com/search?client=safari&hs=7PhU&sca_esv=a9a9972681dccfab&hl=en-us&sxsrf=ANbL-n4veoWG7eEpBBwjDXaZmvvolmNBUA:1771296907990&q=urban+oasis+massage+%26+wellness+reviews&uds=ALYpb_kvW42IGJqj2DPrnL3j1f7_QvoLR4Og-uIVf4DptQCJ0OiJy0Tje4sk_02gLo0HLOtZ_7gRXKF0mmXOqD9HCTMPijYuYWxJf3i-5Ip4OGuv_UqOgIFQiQC6kzA0TDpwBuvZjtbyzV9Cr9KQSSZJAqUlKuJ-SDKHFW-lstbQU9cNyJecvmQxcwU2r9qVnu4sCvWvHbL7gXrBOG0-Pmq0-kRbE6VxdlLT1sitKDUSZCfHVGw6U_VmxmwaYjvImJezhZx5o0YscuOiG93zGuLdEsKrkN7A8oHxZG0x9OBrvaC4UNKA1UrMSQpknJWJNI6XoEBx-yoHCDDsG6bOblPeFehGZLuNu95WKkxnFpkfZAXXcsjfk9QPktBxHlkQxCHxqBjwvvSEcBGsXi3FnQFpVM1nGg6dwSv8mZXk61Er4XvBRsGDj0elI6vnBVVTByHuXENycO0PIv_Gzo3l28mQTkztY_kNq9uiIlmHyi64mbKjWcjb4Co&si=AL3DRZEsmMGCryMMFSHJ3StBhOdZ2-6yYkXd_doETEE1OR-qOWnM1VFga8ZdGwH6ts8zjCn5iEWVZEoGTbU7H5en-cdPAyLzXKXTLrDxn4swSFS8KXJO_eHtfypeDxWPrbCLMK9ikUWY6oy8pVESEIIpKQQw9rppGg%3D%3D&sa=X&ved=2ahUKEwjWiPiXw9-SAxWFJEQIHX3uF9oQk8gLegQIGxAB&ictx=1&biw=393&bih=749&dpr=3#ebo=1">

  <h1>Leave Whitney a quick review</h1>
  <p class="business">Urban Oasis Massage & Wellness</p>

  <button id="draftBtn">Draft review with AI</button>

  <textarea
    id="reviewText"
    placeholder="Your review will appear here..."
    rows="5"
  ></textarea>

  <div class="actions">
    <button id="copyBtn">Copy review</button>

    <a
      id="googleBtn"
      href="#"
      target="_blank"
      class="google-btn"
    >
      Open Review Page
    </a>
  </div>

  <p class="note">
    After tapping, paste your review and finish editing it on the review page before submitting.
  </p>
</div>

<script src="../script.js"></script>

<script>
(function () {
  const reviewText = document.getElementById("reviewText");
  const googleBtn = document.getElementById("googleBtn");
  const draftBtn = document.getElementById("draftBtn");
  const card = document.querySelector(".card");

  if (!reviewText || !googleBtn || !card) return;

  const reviewUrl =
    card.dataset.googleReviewUrl ||
    card.dataset.googleUrl ||
    "#";

  googleBtn.href = reviewUrl;

  // -------- TEXTBOX LOCK AFTER AI FILLS --------
  let watcher = null;

  function lockBox() {
    reviewText.readOnly = true;
    reviewText.style.background = "#f6f6f6";
    reviewText.style.cursor = "default";
  }

  function unlockBox() {
    reviewText.readOnly = false;
    reviewText.style.background = "";
    reviewText.style.cursor = "";
  }

  function startWatcher() {
    if (watcher) clearInterval(watcher);

    watcher = setInterval(() => {
      if ((reviewText.value || "").trim().length > 0) {
        lockBox();
        clearInterval(watcher);
        watcher = null;
      }
    }, 250);
  }

  startWatcher();

  if (draftBtn) {
    draftBtn.addEventListener("click", () => {
      unlockBox();
      startWatcher();
    });
  }

  // -------- SAFE REDIRECT DELAY --------
  googleBtn.addEventListener("click", function (e) {
    const url = googleBtn.getAttribute("href");
    if (!url || url === "#") return;

    e.preventDefault();

    const original = googleBtn.textContent;
    googleBtn.textContent = "Openingâ€¦";
    googleBtn.style.pointerEvents = "none";

    const newWin = window.open("about:blank", "_blank");
    const delayMs = 2200;

    setTimeout(() => {
      try {
        if (newWin && !newWin.closed) {
          newWin.location.href = url;
        } else {
          window.location.href = url;
        }
      } finally {
        googleBtn.textContent = original;
        googleBtn.style.pointerEvents = "";
      }
    }, delayMs);
  });
})();
</script>

</body>
</html>